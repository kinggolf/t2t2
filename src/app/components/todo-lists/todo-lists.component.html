<button mat-button [matMenuTriggerFor]="menu"
        style="position: absolute; right: 0; margin-top: -45px; z-index: 101;">
  <i class="material-icons iconFontSpecMore">more_horiz</i>
</button>
<mat-menu #menu="matMenu" xPosition="after">
  <div *ngIf="userTodoLists">
    <button *ngIf="!creatingNewList" mat-menu-item (click)="createNewList()">
      Create A New List
    </button>
    <button mat-menu-item (click)="showHelp.emit()">Show Help</button>
    <button *ngIf="isOnline" mat-menu-item (click)="logout()">Logout</button>
  </div>
</mat-menu>

<mat-spinner *ngIf="showLoadingSpinner" [diameter]="30" style="margin: 0 auto;"></mat-spinner>
<div cdkDropList (cdkDropListDropped)="drop($event)" class="screenMargin">
  <div *ngFor="let todoList of userTodoLists; let i = index;" style="margin-top: 1em;"
       cdkDragDisabled="{{ editingListNameIndex > -1 || showListDetailsIndex > -1 || addingTodoListIndex > -1 }}"
       cdkDragLockAxis="y" cdkDrag>
    <mat-card *ngIf="editingListNameIndex !== i" #todoListCard>

      <mat-card-header (click)="showListDetails(i)" style="margin: 0;">
        <mat-card-title style="margin-bottom: 6px; font-size: 0.8em; color: #6D4C41;">
          {{ todoList.listName }}
        </mat-card-title>
      </mat-card-header>

      <mat-card-content style="margin-bottom: 0;" #todoListCardContent>
        <div [@showTodos]="showListDetailsIndex === i ? 'show' : 'hide'" style="overflow: hidden;">
          <app-todos [userTodoList]="todoList" [userDocId]="userDetails.userDocId"
                     (cancelEditTodoLabel)="addingTodoListIndex = -1">
          </app-todos>
        </div>
      </mat-card-content>

      <mat-card-actions #todoListCardAction>
        <div class="actionRow">
          <div class="actionCell16">
            <button (click)="editListName(i)" class="baseMatIconLists" title="Edit Name">
              <i class="material-icons iconFontSpec">border_color</i>
            </button>
          </div>
          <div class="actionCell16">
            <button (click)="addNewTodo(i)" class="baseMatIconLists" title="Add Todo">
              <i class="material-icons iconFontSpec">add_circle</i>
            </button>
          </div>
          <div class="actionCell16">
            <button (click)="confirmDeleteList(i)" class="baseMatIconLists" title="Delete List">
              <i class="material-icons iconFontSpec">delete</i>
            </button>
          </div>
          <div class="actionCell16" cdkDragHandle>
            <button [ngClass]="editingListNameIndex === -1 && showListDetailsIndex === -1 && addingTodoListIndex === -1
                               ? 'baseMatIconLists' : 'baseMatIconHide'">
              <i class="material-icons iconFontSpec">drag_indicator</i>
            </button>
          </div>
          <div class="actionCell16">
            <div class="baseMatIconLists">
              <div>Completed</div>
              <div class="iconFontSpec">{{ todoList.itemsCompleted }}</div>
            </div>
          </div>
          <div class="actionCell16">
            <div class="baseMatIconLists">
              <div>Pending</div>
              <div class="iconFontSpec">{{ todoList.itemsPending }}</div>
            </div>
          </div>
        </div>

      </mat-card-actions>
    </mat-card>

    <mat-card *ngIf="editingListNameIndex === i" style="margin: 2rem 0.5rem;">
      <form novalidate [formGroup]="newTodoListNameForm">
        <mat-form-field style="margin-left: 1.2rem;">
          <input matInput placeholder="List Name" formControlName="newListName">
        </mat-form-field>

        <mat-card-actions>
          <div style="display: table; width: 100%; text-align: center;">
            <div style="display: table-cell; width: 50%;">
              <button (click)="saveListName(i)" class="baseMatIconTextOnly" [disabled]="!newTodoListNameForm.valid">
                Save
              </button>
            </div>
            <div style="display: table-cell; width: 50%;">
              <button (click)="cancelEditListName(i)" class="baseMatIconTextOnly">Cancel</button>
            </div>
          </div>
        </mat-card-actions>

      </form>
    </mat-card>
  </div>
</div>
